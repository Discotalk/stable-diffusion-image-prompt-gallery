#!/bin/sh

# For each of the groups, are the montage images available?
# If not, then generate the montage images.
#
# We skip optimizing via optipng because we know that the
# individual images are already optimized to optipng -o7,
# and in practice montage images are within 1% of optimized,
# and in practice optimization takes an excessively long time.

find groups -type d -depth 1 | sed 's#^groups/##' | sort | while read -r x; do
	echo "$x"
	src="groups/$x"
	dst="build/groups/$x"
	if [ ! -d "$dst" ]; then
		mkdir -p "$dst"
	 	montage -tile 2x2 -geometry 640x448+1+1 -border 0 "$src/1.png" "$src/2.png" "$src/3.png" "$src/4.png" "$dst/montage-tile-2x2.png"
	 	montage -tile 3x3 -geometry 640x448+1+1 -border 0 "$src/1.png" "$src/2.png" "$src/3.png" "$src/4.png" "$src/5.png" "$src/6.png" "$src/7.png" "$src/8.png" "$src/9.png" "$dst/montage-tile-3x3.png"
		montage -tile 2x1 -geometry 640x448+1+1 -border 0 "$src/1.png" "$src/2.png" "$dst/montage-stack-1.png"
		montage -tile 3x1 -geometry 426x298+1+1 -border 0 "$src/3.png" "$src/4.png" "$src/5.png" "$dst/montage-stack-2.png"
		montage -tile 4x1 -geometry 320x224+1+1 -border 0 "$src/6.png" "$src/7.png" "$src/8.png" "$src/9.png" "$dst/montage-stack-3.png"
	fi
done
